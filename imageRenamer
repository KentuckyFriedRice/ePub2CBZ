#!/bin/bash

currentDir=pwd

if [ -n $1 ]; then
	current=$1
fi
current=$1

#Getting the naming convention fo the html files
first="$(find . -maxdepth 1 \( -name '*1*.html' -o -name '*1*.xhtml' \) | head -n1)"
prefix="$(echo "$first" | sed -E 's/[0-9]+.*//')"
prefix="${prefix/.\//}"
#echo "Prefix is $prefix"
extension=".${first##*.}"
#echo "Extension is $extension"

# Folder where your HTML files are
html_dir="."

# Folder where images are stored relative to HTML files
img_dir="$html_dir/images"

# Destination folder for copied images
dest_dir="$1/ordered_images"

mkdir -p "$dest_dir"

for html_file in "$html_dir"/"$prefix"*"$extension"; do
    # Extract number from filename, e.g. 000 from index_split_000.html
    num="${html_file/$prefix/}"
    num="${num%$extension}"

    # Extract the image filename from the <img src="..."> tag
    img_name=$(sed -n 's/.*<img src="images\/\([^"]*\)".*/\1/p' "$html_file")

    if [ -z "$img_name" ]; then
        #echo "No image found in $html_file"
        continue
    fi

    # Source image path
    src_img="$img_dir/$img_name"

    #Checks if the source image exists
    if [ ! -f "$src_img" ]; then
        echo "Image $src_img not found!"
        continue
    fi

    # Destination image path, e.g. 000.jpg, 001.jpg, ...
    dest_img="$dest_dir/${num}.jpg"

    cp "$src_img" "$dest_img"
done

