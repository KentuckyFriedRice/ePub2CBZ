#!/bin/bash

currentDir=pwd

if [ -n $1 ]; then
	current=$1
fi

# Folder where your HTML files are
html_dir="."

# Folder where images are stored relative to HTML files
img_dir="$html_dir/images"

# Destination folder for copied images
dest_dir="$1/ordered_images"

mkdir -p "$dest_dir"

for html_file in "$html_dir"/index_split_*.html; do
    # Extract number from filename, e.g. 000 from index_split_000.html
    num=$(basename "$html_file" | sed -E 's/index_split_([0-9]+)\.html/\1/')

    # Extract the image filename from the <img src="..."> tag
    img_name=$(grep -oP '<img src="images/\K[^"]+' "$html_file")

    if [[ -z "$img_name" ]]; then
        #echo "No image found in $html_file"
        continue
    fi

    # Source image path
    src_img="$img_dir/$img_name"

    if [[ ! -f "$src_img" ]]; then
        echo "Image $src_img not found!"
        continue
    fi

    # Destination image path, e.g. 000.jpg, 001.jpg, ...
    dest_img="$dest_dir/${num}.jpg"

    cp "$src_img" "$dest_img"
    #echo "Copied $src_img to $dest_img"
done

