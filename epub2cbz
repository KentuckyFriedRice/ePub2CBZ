#!/bin/bash

directoryBool=0
options=""

while getopts "c:dji" opt; do
	case $opt in
		c) options+=" -c $OPTARG" ;;
		i) options+=" -i" ;;
		d) directoryBool=1 ;;
		j) options+=" -j" ;;
		*)
		  echo "Usage: $0 [-i jumbled] [-j Japan_mode] [-d directory] [file.epub | directory]"
		  exit 1
		;;
	esac
done

shift $((OPTIND - 1))

input="${!#}"
 
if ! command -v "epub2cbz_converter" >/dev/null 2>&1; then
	echo "You need 'epub2cbz_converter' and it wasn't found in this directory or it's not executable"
	exit 1
fi
if ! command -v "imageRenamer" >/dev/null 2>&1; then
	echo "You need 'imageRenamer' and it wasn't found in this directory or it's not executable"
	exit 1
fi

if [ $directoryBool -eq 1 ]; then
	if [ ! -d "$input" ]; then
		echo "Directory not found"
		exit 1
	fi
	
	cd $input
	
	for epub in *.epub; do
		epub2cbz_converter "$epub"
	done

fi

if [ $directoryBool -eq 0 ]; then
	if [ ! -f "$input" ]; then
		echo "File not found"
		exit 1
	fi
	if [ ".${input##*.}" != ".epub" ]; then
		echo "Not an epub"
		exit 1
	fi
	
	options=${options# }
	epub2cbz_converter $options "$input"
fi

#echo "epub2cbz$options" "$input"
#echo "Directory Bool = $directoryBool" 
